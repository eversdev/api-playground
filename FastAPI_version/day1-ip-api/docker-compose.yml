version: "3.9"

services:
  # PostgreSQL database service
  postgres:
    image: postgres:17.6-trixie
    environment:
      TEST_MODE: "1"  # Enables test mode for the application
      POSTGRES_USER: ${POSTGRES_USER}  # Database username from .env
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}  # Database password from .env
      POSTGRES_DB: ${POSTGRES_DB}  # Database name from .env
    ports:
      - "5432:5432"  # Expose DB port for testing; remove in production

  # FastAPI application service
  fastapi:
    # Mount current directory into container for live reload
    volumes:
      - ./:/app
    build: .  # Build Dockerfile in current directory
    ports:
      - "8000:8000"  # Map container port 8000 to host port 8000
    env_file: .env  # Load environment variables from .env file
    command: uvicorn fastapi_version.main:app --host 0.0.0.0 --port 8000 --reload
    # --reload enables live reload during development; remove in production
